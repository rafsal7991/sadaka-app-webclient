import{ag as A,a as s,ba as g,j as e,Q as f,ar as j,I as c,r as h,aq as P}from"./index.ef1be1b9.js";import{L as b}from"./LoadingIcon.5d40e9d4.js";import{A as N}from"./Avatar.976fb5a1.js";const z=A.injectEndpoints({tagTypes:["chats","contacts"],endpoints:r=>({getContacts:r.query({query:n=>({url:`contacts?${new URLSearchParams(n).toString()}`,method:"GET"}),providesTags:["contacts"]}),getChat:r.query({query:n=>`/chats/${n}`,providesTags:["chats"]}),getProfileUser:r.query({query:n=>"/profileUsers"}),sendMessage:r.mutation({query:n=>({url:"/send-msg",method:"POST",body:{obj:n}}),invalidatesTags:["chats","contacts"]})})}),{useGetContactsQuery:E,useGetChatQuery:G,useSendMessageMutation:H,useGetProfileUserQuery:Q}=z,y=r=>r?new Date(r).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0}):"",R=({contact:r,openChat:n,selectedChatId:l})=>{const{avatar:m,id:a,fullName:i,status:o,about:x,chat:t}=r;return s("div",{className:g("flex space-x-3 rtl:space-x-reverse cursor-pointer  items-start  p-4   transition-all duration-150 ",{"bg-[#13317d] hover:bg-[#13317d]":a===l,"hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:bg-opacity-70":a!==l}),onClick:()=>n(a),children:[e(N,{src:m,dot:!0,className:"h-9 w-9",dotClass:o==="online"?"bg-[#13317d]":"bg-gray-500"}),s("div",{className:"flex-1 overflow-hidden md:block hidden",children:[e("span",{className:g("block  text-sm  truncate mb-0.5",{"text-white":a===l,"text-gray-600 dark:text-gray-300":a!==l}),children:i}),e("span",{className:g("text-xs truncate  block",{"text-gray-300":a===l," text-gray-400  dark:text-gray-400":a!==l}),children:t!=null&&t.lastMessage?t==null?void 0:t.lastMessage:x})]}),e("div",{className:g("block text-xs  font-normal text-right md:block ",{"text-gray-300":a===l," text-gray-400 dark:text-gray-400":a!==l}),children:e("span",{children:t!=null&&t.lastMessageTime?y(t==null?void 0:t.lastMessageTime):""})})]})},L=[{label:"Remove",link:"#"},{label:"Forward",link:"#"}],$=({message:r,contact:n,profile:l})=>{var x;const{senderId:m,message:a,time:i}=r,{avatar:o}=n;return e(f,{children:e("li",{className:"block md:px-6 px-4",children:m===11?s("div",{className:"flex space-x-2 items-start justify-end group w-full rtl:space-x-reverse",children:[s("div",{className:"no flex space-x-4 rtl:space-x-reverse",children:[e("div",{className:"opacity-0 invisible group-hover:opacity-100 group-hover:visible",children:e(j,{classMenuItems:" w-[100px] left-0 top-0  ",items:L,label:e("div",{className:"h-8 w-8 bg-indigo-100 dark:bg-gray-900 dark:text-gray-400 flex flex-col justify-center items-center text-xl rounded-full text-indigo-500",children:e(c,{icon:"heroicons-outline:dots-horizontal"})})})}),s("div",{className:"whitespace-pre-wrap break-all",children:[e("div",{className:"text-contrent p-3 bg-[#13317d]text-white text-sm font-normal rounded-md flex-1 mb-1",children:a}),e("span",{className:"font-normal text-xs text-gray-400",children:y(i)})]})]}),e("div",{className:"flex-none",children:e("div",{className:"h-8 w-8 rounded-full",children:e("img",{src:(x=l==null?void 0:l.profileUser)==null?void 0:x.avatar,alt:"",className:"block w-full h-full object-cover rounded-full"})})})]}):s("div",{className:"flex space-x-2 items-start group rtl:space-x-reverse ",children:[e("div",{className:"flex-none",children:e("div",{className:"h-8 w-8 rounded-full",children:e("img",{src:o,alt:"",className:"block w-full h-full object-cover rounded-full"})})}),s("div",{className:"flex-1 flex space-x-4 rtl:space-x-reverse",children:[s("div",{children:[e("div",{className:"text-contrent p-3 bg-indigo-100 dark:bg-gray-600 dark:text-gray-300 text-gray-600 text-sm font-normal mb-1 rounded-md flex-1 whitespace-pre-wrap break-all",children:a}),e("span",{className:"font-normal text-xs text-gray-400 dark:text-gray-400",children:y(i)})]}),e("div",{className:"opacity-0 invisible group-hover:opacity-100 group-hover:visible",children:e(j,{classMenuItems:" w-[100px] top-0",items:L,label:e("div",{className:"h-8 w-8 bg-indigo-50 dark:bg-gray-600 dark:text-gray-300 text-indigo-400 flex flex-col justify-center items-center text-xl rounded-full",children:e(c,{icon:"heroicons-outline:dots-horizontal"})})})})]})]})})})},B=({handleSendMessage:r})=>{const[n,l]=h.exports.useState(""),m=i=>{l(i.target.value)},a=i=>{i.preventDefault(),r(n),l("")};return s("footer",{className:"md:px-6 px-4 sm:flex md:space-x-4 sm:space-x-2 rtl:space-x-reverse border-t md:pt-6 pt-4 border-gray-100 dark:border-gray-700 bg-white dark:bg-gray-800",children:[s("div",{className:"flex-none sm:flex hidden md:space-x-3 space-x-1 rtl:space-x-reverse",children:[e("div",{className:"text-xl text-indigo-500 cursor-pointer ",children:e(c,{icon:"heroicons-outline:link"})}),e("div",{className:" text-xl text-indigo-500 cursor-pointer",children:e(c,{icon:"heroicons-outline:emoji-happy"})})]}),s("form",{onSubmit:a,className:"flex-1 relative flex space-x-3 rtl:space-x-reverse",children:[e("div",{className:"flex-1",children:e("textarea",{type:"text",value:n,onChange:m,placeholder:"Type your message...",className:"focus:ring-0 focus:outline-0 block w-full bg-transparent dark:text-white resize-none",onKeyDown:i=>{i.key==="Enter"&&!i.shiftKey&&(i.preventDefault(),a(i))}})}),e("div",{className:"flex-none md:pr-0 pr-3",children:e("button",{type:"submit",className:"h-8 w-8 bg-[#13317d]xt-white flex flex-col justify-center items-center text-lg rounded-full",children:e(c,{icon:"heroicons-outline:paper-airplane",className:"transform rotate-[60deg]"})})})]})]})},F=()=>s("div",{className:"text-center space-y-1",children:[e(c,{icon:"ph:wechat-logo-light",className:"text-gray-500 dark:text-gray-400 text-7xl mx-auto"}),e("div",{className:"text-2xl text-gray-600 dark:text-gray-300 font-medium",children:"No chat selected"}),e("div",{className:"text-sm text-gray-500 ",children:`don't worry, just take a deep breath & say "Hello"`})]}),I=({contact:r})=>e("header",{className:"border-b border-gray-200 dark:border-gray-700  bg-white dark:bg-gray-800 rounded-tr-md",children:s("div",{className:"flex py-3 px-3 items-center",children:[e("div",{className:"flex-1",children:s("div",{className:"flex space-x-3 rtl:space-x-reverse",children:[e("div",{className:" flex-none",children:e(N,{src:r==null?void 0:r.avatar,dot:!0,className:"h-10 w-10",dotClass:(r==null?void 0:r.status)==="online"?"bg-[#13317d]":"bg-gray-500"})}),s("div",{className:"flex-1 text-start",children:[e("div",{children:r==null?void 0:r.fullName}),e("div",{className:"block text-gray-500 dark:text-gray-300 text-xs font-normal",children:(r==null?void 0:r.status)==="online"?"Active":"Offline"})]})]})}),s("div",{className:"flex-none flex md:space-x-3 space-x-1 items-center rtl:space-x-reverse",children:[e("button",{className:"icon-btn  w-9 h-9 rounded-full text-xl",children:e(c,{icon:"ph:phone-call"})}),e("button",{className:"icon-btn w-9 h-9 rounded-full text-xl ",children:e(c,{icon:"ph:camera"})})]})]})}),W=()=>{var w,M,S,T;const[r,n]=h.exports.useState(null),[l,m]=h.exports.useState(""),{data:a=[],isLoading:i}=E(l),{data:o,isLoading:x}=G(r),{data:t,isLoading:K}=Q(),[C,{isLoading:q}]=H(),U=d=>{n(d)},k=d=>{if(!r||!d)return;C({message:d,contact:{id:r}})},u=h.exports.useRef(null);h.exports.useEffect(()=>{u.current&&u.current.scrollTo({top:u.current.scrollHeight,behavior:"smooth"})},[k,a]);const v=((w=o==null?void 0:o.chat)==null?void 0:w.chat)||[];return s("div",{className:"flex chat-height  shadow-md bg-white",children:[e("div",{className:"flex-none lg:w-[260px] md:w-[200px] w-20 border-r border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 rounded-md rounded-tr-none rounded-br-none ",children:e(P,{className:"  h-full ",children:i?e(b,{}):s(f,{children:[e("div",{className:"sticky top-0 z-[1]  py-3 px-4 rounded-tl-md  bg-white/70 border-gray-200 dark:border-gray-700 border-b  backdrop-blur-sm dark:bg-gray-800/50",children:s("div",{className:"flex space-x-3 rtl:space-x-reverse",children:[e(N,{src:(M=t==null?void 0:t.profileUser)==null?void 0:M.avatar,dot:!0,className:"h-10 w-10",dotClass:((S=t==null?void 0:t.profileUser)==null?void 0:S.status)==="online"?"bg-[#13317d]":"bg-gray-500"}),e("div",{className:"flex-1 md:block hidden",children:e("input",{type:"text",className:"text-control py-2 rounded-full",placeholder:"Search..",value:l,onChange:d=>m(d.target.value)})})]})}),(T=a==null?void 0:a.contacts)==null?void 0:T.map((d,p)=>e(R,{openChat:U,contact:d,selectedChatId:r},`contact-list-${p}`))]})})}),e("div",{className:g("flex-1",{"flex flex-col items-center justify-center":!r}),children:r?s(f,{children:[e(I,{contact:o==null?void 0:o.contact}),e("div",{className:"parent-height",children:e("ul",{className:"msgs overflow-y-auto msg-height pt-6 space-y-6 ",ref:u,children:x?e(b,{}):s(f,{children:[v==null?void 0:v.map((d,p)=>e($,{message:d,contact:o==null?void 0:o.contact,profile:t},`message-list-${p}`)),q&&e(b,{className:"text-indigo-500 h-10 ml-auto mr-10 mb-6"})]})})}),!x&&e(B,{handleSendMessage:k})]}):e(F,{})})]})};export{W as default};
